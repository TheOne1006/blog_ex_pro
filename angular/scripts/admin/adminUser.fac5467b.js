"use strict";var ngApp;ngApp=angular.module("theoneApp",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ui.router","ngGrid","ui.bootstrap","ui.tinymce","ui.codemirror","ngTagsInput","ngSanitize","ngTouch","angularFileUpload","theOneBlog.service"]);angular.module("theOneBlog.service",["ngResource"]);"use strict";angular.module("theoneApp").directive("previewImg",["$window",function(a){var b={support:!!(a.FileReader&&a.CanvasRenderingContext2D),isFile:function(b){return angular.isObject(b)&&b instanceof a.File},isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(b)!==-1}};return{restrict:"A",scope:{mypreview:"="},template:"<canvas/>",link:function(a,c,d){var e=new FileReader;var f=c.find("canvas");var g=a.$eval(d.previewImg);var h=true;if(!b.support){h=false}if(!h){c.empty().html("<img />");f=c.find("img")}a.$watch("mypreview",function(){if(!b.isFile(a.mypreview)){return}if(!b.isImage(a.mypreview)){return}e.onload=i;e.readAsDataURL(a.mypreview)});function i(a){var b=new Image;b.onload=j;b.src=a.target.result}function j(){var a=g.width||this.width/this.height*g.height;var b=g.height||this.height/this.width*g.width;f.attr({width:a,height:b});if(h){f[0].getContext("2d").drawImage(this,0,0,a,b)}else{f.attr({src:angular.element(this).attr("src")})}}}}}]).directive("fileChange",["$parse",function(a){return{restrict:"A",link:function(b,c,d){var e=a(d.fileChange);var f=function(a){b.$apply(function(){e(b,{$event:a,files:a.target.files})})};c[0].addEventListener("change",f,false)}}}]);"use strict";angular.module("theoneApp").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/");a.state("user",{url:"/",views:{"":{templateUrl:"/angular/views/admin/user/index.html"}}}).state("user.photo",{url:"photo",views:{"@":{templateUrl:"/angular/views/admin/user/user.photo.html"}}})}]);"use strict";angular.module("theoneApp").factory("userPhotoService",["$http","$modal",function(a,b){var c=function(b){return a.get(b)};var d=function(b,c){return a.delete(b,c)};var e=function(a){var c=b.open(a);c.result.then(function(a){console.log(a)})};return{modalOpen:function(a){return e(a)},getMyPhotos:function(){return c("/admin/user/myPhotoList")},upload2Cloud:function(a,b){return c(a+"/"+b)},getUserInfo:function(){return c("/admin/user/myInfo")},createPerson:function(){return c("/admin/user/createFacePerson")},updatePerson:function(){return c("/admin/user/updateFacePerson")},delete4Cloud:function(a,b){return d(a,b)},delete4FacePP:function(a,b){return d(a,b)}}}]);angular.module("theoneApp").controller("UserController",["$scope",function(a){a.name=""}]).controller("UserPhotoController",["$scope","$http","userPhotoService",function(a,b,c){a.photos=[];a.user="";a.facePpPower={create:false,update:false};c.getMyPhotos().success(function(b){a.photos=b});c.getUserInfo().success(function(c){a.user=c;if(c.facePersonId){a.facePpPower.update=true}else{b.get("/admin/user/createFacePower").success(function(b){if(b&&b.hasCreatePower){a.facePpPower.create=b.hasCreatePower}})}});a.takePhoto=function(){c.modalOpen({templateUrl:"/angular/views/modal/user.photo.add.html",size:"lg",controller:"UserPhotoAddController",backdropClass:"heightfull"})};a.uploader={cloud:function(a){console.log("111");c.upload2Cloud("/admin/user/up2cloud",a).success(function(a){console.log(a)})},facePP:function(a){c.upload2Cloud("/admin/user/up2facePP",a).success(function(a){console.log(a)})},createPerson:function(){if(!a.facePpPower.create){return false}c.createPerson().success(function(a){console.log(a)})},updatePerson:function(){if(!a.facePpPower.update){return false}c.updatePerson().success(function(a){console.log(a)})}};a.deleter={cloud:function(a){c.delete4Cloud("/admin/user/cloudSingle/"+a)},facePP:function(a){c.delete4FacePP("/admin/user/faceSingle/"+a)}}}]).controller("UserPhotoAddController",["$scope","$http","$modalInstance","$window",function(a,b,c,d){var e=d.Webcam;a.photoList=[];if(e){e.set({width:360,height:280,image_format:"jpeg",jpeg_quality:90})}a.begin=function(){e.attach("#modalMovie")};a.cancel=function(){if(e.container){e.reset()}c.dismiss()};a.delphoto=function(b){a.photoList.splice(b,1)};a.ok=function(){if(e.container){e.snap(function(b){a.photoList.push(b)})}};a.upload=function(){if(!a.photoList){return}b.post("/admin/user/addUserPhotos",{photos:a.photoList}).success(function(a){console.log(a)})}}]);