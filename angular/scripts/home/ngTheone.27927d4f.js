"use strict";var ngApp;ngApp=angular.module("theOneBlog",["ngAnimate","ngAria","ngCookies","ngMessages","ngResource","ui.router","ui.bootstrap","ngSanitize","ngTouch","theOneBlog.directives","theOneBlog.filters","theOneBlog.services","theOneBlog.route","theOneBlog.controllers","mgcrea.ngStrap","angular-carousel","angularMermaid"]).config(["$httpProvider",function(a){a.defaults.cache=!1}]).factory("browserHelp",["$window",function(a){var b=a.innerWidth,c=768,d=180;return{isMobile:c>b,defultContentWidth:d}}]),angular.module("theOneBlog.directives",[]),angular.module("theOneBlog.filters",[]),angular.module("theOneBlog.services",["ngResource"]),angular.module("theOneBlog.route",["ui.router"]),angular.module("theOneBlog.controllers",["theOneBlog.services"]),angular.module("theOneBlog.directives").directive("compileHtml",["$compile",function(a){return{restrict:"A",link:function(b,c,d){b.$watch(function(a){return a.$eval(d.compileHtml)},function(d){c.html(d),a(c.contents())(b)})}}}]),angular.module("theOneBlog.directives").directive("prettyprint",["$window",function(a){return{restrict:"C",link:function(b,c){var d=a.prettyPrintOne;d&&angular.isFunction(d)&&c.html(d(c.html(),"",!0))}}}]),angular.module("theOneBlog.directives").directive("scrollAnimate",[function(){return{restrict:"A",link:function(a,b,c){var d=c.target;b.bind("click",function(a){a.stopPropagation();var b=angular.element(d),c=b.offset()&&b.offset().top;c&&angular.element("body").animate({scrollTop:c})})}}}]),angular.module("theOneBlog.filters").filter("ArticlesByCateWordLimit",["browserHelp",function(a){function b(a,b){return a.length>b?a.slice(0,b)+"...":a}var c=a.defultContentWidth;return function(a,d){var e=a.length;return(!d||isNaN(d))&&(d=c),0===e?a:(angular.forEach(a,function(c,e){a[e].contentText=b(c.contentText,d)}),a)}}]),angular.module("theOneBlog.filters").filter("IndexArticlesWordlimit",["browserHelp",function(a){function b(a,b){return a.length>b?a.slice(0,b)+"...":a}var c=a.defultContentWidth;return function(a,d){var e=a.length;return(!d||isNaN(d))&&(d=c),0===e?a:(angular.forEach(a,function(c,e){if(angular.isArray(c.topArticles)&&c.topArticles.length>0)for(var f=c.topArticles.length-1;f>=0;f--)a[e].topArticles[f].contentText=b(c.topArticles[f].contentText,d)}),a)}}]),angular.module("theOneBlog.filters").filter("keyWordPoint",["$filter",function(a){return function(b,c){return angular.isArray(b)?0===b.length?[]:(angular.forEach(b,function(d,e){b[e].title=a("keyordEm")(d.title,"title",c),b[e].contentText=a("keyordEm")(d.contentText,"content",c),angular.forEach(d.keyWords,function(d,f){b[e].keyWords[f]=a("keyordEm")(d,"tag",c)})}),b):b}}]),angular.module("theOneBlog.filters").filter("keyordEm",["browserHelp",function(a){function b(a,b){return a.toLowerCase()===b.toLowerCase()?f+a+g:a}function c(a,b,c){var h=-1;return e=new RegExp(b,"i"),h=a.search(e),c&&(a=d(a,h,c)),-1!==h?a.replace(e,f+"$&"+g):a}function d(a,b,c){var d,e=a.length;return c>=e?a:(d=Math.floor(c/2),0>=b-d?a.slice(0,c)+"...":b+d>=e?"..."+a.slice(-c):"..."+a.slice(b-d,b+d)+"...")}var e,f="<em>",g="</em>",h=a.defultContentWidth;return function(a,d,e,f){if(void 0===e)return a;switch((!f||isNaN(f))&&(f=h),d){case"tag":a=b(a,e);break;case"title":a=c(a,e);break;case"content":a=c(a,e,f)}return a}}]),angular.module("theOneBlog.filters").filter("cateContain",[function(){return function(a){var b=[];return angular.isArray(a)?(angular.forEach(a,function(a){if(a.cate&&a.cate._id){for(var c=0;c<b.length;c++)if(a.cate._id===b[c]._id)return void b[c].resultNum++;return a.cate.resultNum=1,void b.push(a.cate)}}),b):b}}]),angular.module("theOneBlog.services").factory("catesService",["$resource","$q",function(a,b){var c=[],d=a("/api/cates/all",null,{timeout:2e4}),e=function(){return d.query(null,function(a){a.length>0&&(c=a)})};return{getAllCates:function(){if(void 0!==c&&0!==c.length){var a=b.defer();return a.resolve(c),{$promise:a.promise}}return e()}}}]),angular.module("theOneBlog.services").factory("carouselsService",["$q","$resource",function(a,b){var c=[],d=b("/api/carousels",{},{timeout:2e4}),e=function(){return d.query({},function(a){a.length>0&&(c=a)})};return{getIndexList:function(){if(angular.isArray(c)&&c.length>0){var b=a.defer();return b.resolve(c),{$promise:b.promise}}return e()}}}]),angular.module("theOneBlog.services").factory("indexArticlesService",["$resource","$q",function(a,b){function c(){return e.query({},{},function(a){a.length>0&&(d=a)})}var d=[],e=a("/home/index/list");return{getList:function(){if(void 0!==d&&0!==d.length){var a=b.defer();return a.resolve(d),{$promise:a.promise}}return c()}}}]),angular.module("theOneBlog.services").factory("articlesService",["$resource",function(a){var b=a("/api/articles/:cateId",{},{queryByCateAlias:{url:"/api/articlesByCateAlias/:cateAlias",method:"get",params:{page:1,limit:12},isArray:!1},countByCateId:{url:"/api/cate/articlesCount/:cateId",method:"get",isAarray:!1}}),c=function(a,c){return b.queryByCateAlias({cateAlias:a,page:c},function(a){})},d=function(a){return b.countByCateId({cateId:a},function(a){})};return{getArticlesByCateAliasList:function(a,b){return c(a,b)},getArticlesByIdCount:function(a){return d(a)}}}]),angular.module("theOneBlog.services").factory("articleService",["$resource","$q",function(a,b){var c,d=a("/api/article/:id",{id:"@id"}),e=function(a){return d.get({id:a},function(a){c=a})};return{getById:function(a){if(void 0!==c&&c._id===a){var d=b.defer();return d.resolve(c),{$promise:d.promise}}return e(a)}}}]),angular.module("theOneBlog.services").factory("searchService",["$resource",function(a){var b=a("/api/search/articles/:keyWord"),c=function(a){return b.query({keyWord:a},function(a){console.log(a)})};return{getListByKeyWord:function(a){return c(a)}}}]),angular.module("theOneBlog.services").factory("headerHelp",[function(){function a(a){var b;return""!==a&&angular.isString(a)?g.text(a):(b=j(),b!==d&&g.text(d)),!0}function b(a){var b;return""!==a&&angular.isString(a)?h.attr("content",a):(b=k(),b!==e&&h.attr("content",e)),!0}function c(a){var b;return""!==a&&angular.isString(a)?i.attr("content",a):(b=l(),b!==f&&i.attr("content",f)),!0}var d,e,f,g=angular.element("title"),h=angular.element("meta[name=description]"),i=angular.element("meta[name=keywords]"),j=function(){return g.text()},k=function(){return h.attr("content")},l=function(){return i.attr("content")};return d=j(),e=k(),f=l(),{changeTitle:a,changeDescription:b,changekeyWord:c,resetAll:function(){var a=j(),b=k(),c=l();a!==d&&g.text(d),b!==e&&h.attr("content",e),c!==f&&i.attr("content",e)},init:function(){}}}]),angular.module("theOneBlog").config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){c.html5Mode({enabled:!0,requireBase:!1}),a.state("main",{"abstract":!0,url:"",views:{"@":{templateUrl:"/angular/views/home/main.html",controller:"mainCtrl"},"header@main":{templateUrl:"/angular/views/home/header.html",controller:"headerCtrl"}}}).state("main.index",{url:"/",views:{banner:{templateUrl:"/angular/views/home/banner.html",controller:"indexCarouselCtrl"},bodyer:{templateUrl:"/angular/views/home/main.content.html",controller:"indexArticlesCtrl"},"affix@main.index":{templateUrl:"/angular/views/home/affix.html",controller:"indexAffixCtrl"}},resolve:{indexList:["indexArticlesService",function(a){return a.getList().$promise}]}}).state("main.cate",{url:"/cate/:cateAlias/:page",views:{banner:{templateUrl:"/angular/views/home/article/article.banner.html"},bodyer:{templateUrl:"/angular/views/home/articles/articles.list.html",controller:"articlesCtrl"}},resolve:{articlesByCateName:["$stateParams","articlesService",function(a,b){var c=a.page?a.page:"1",d=a.cateAlias;return b.getArticlesByCateAliasList(d,c).$promise}],totalNum:["articlesByCateName","articlesService",function(a,b){return b.getArticlesByIdCount(a.cate._id).$promise}]}}).state("main.article",{"abstract":!0,url:"/article",views:{banner:{templateUrl:"/angular/views/home/article/article.banner.html"}}}).state("main.article.single",{url:"/id/:articleId",views:{"bodyer@main":{templateUrl:"/angular/views/home/article/article.html",controller:"articleCtrl"}},resolve:{article:["$stateParams","articleService",function(a,b){return b.getById(a.articleId).$promise}]}}).state("main.search",{"abstract":!0,url:"/search",views:{banner:{templateUrl:"/angular/views/home/article/article.banner.html"}}}).state("main.search.goanything",{url:"/:searchWord",views:{"bodyer@main":{templateUrl:"/angular/views/home/search/search.bodyer.html",controller:"searchCtrl"}}}),b.otherwise("/")}]),angular.module("theOneBlog.controllers").controller("articleBannerCtrl",["$scope","$window",function(a,b){var c=b.Vivus,d=new c("vivusTheOne",{type:"scenario-sync",duration:"20",start:"autostart",dashGap:"20",forceRender:!0,file:"/public/svg/theoneIo.svg"});a.vireset=function(){d.reset().play()}}]),angular.module("theOneBlog.controllers").controller("articleCtrl",["$scope","$filter","headerHelp","articleService","article",function(a,b,c,d,e){c.changeTitle(e.title),c.changeDescription(e.descript),c.changekeyWord(e.keyWords.join(",")),a.pageClass="article",e.updateTime=b("date")(e.updateTime,"yyyy-MM-dd"),a.article=e}]),angular.module("theOneBlog.controllers").controller("articlesCtrl",["$scope","$filter","$location","headerHelp","articlesService","articlesByCateName","totalNum",function(a,b,c,d,e,f,g){d.changeTitle(f.cate.name),d.changeDescription(),d.changekeyWord(),a.articleList=b("ArticlesByCateWordLimit")(f.articleList),a.cate=f.cate,console.log(a.cate),a.currentPage=f.curPage,a.articlesTotal=g.total,a.pageNav={maxSize:5,itemsPerPage:12,bigTotalItems:a.articlesTotal,curPage:a.currentPage,pageChang:function(){c.path("/cate/"+a.cate.alias+"/"+a.currentPage,!1)}}}]),angular.module("theOneBlog.controllers").controller("headerCtrl",["$scope","$location","catesService",function(a,b,c){a.cateList=[],c.getAllCates().$promise.then(function(b){a.cateList=b}),a.search={keyWord:""},a.headerView={isCollapsed:!1},a.changeCollapsed=function(){a.headerView.isCollapsed=!a.headerView.isCollapsed},a.goSearch=function(){a.search.keyWord&&b.path("/search/"+a.search.keyWord)}}]),angular.module("theOneBlog.controllers").controller("indexAffixCtrl",["$scope","indexList",function(a,b){a.cates=b}]),angular.module("theOneBlog.controllers").controller("indexArticlesCtrl",["$scope","$filter","indexArticlesService","headerHelp","indexList",function(a,b,c,d,e){d.resetAll(),a.indexList=b("IndexArticlesWordlimit")(e)}]),angular.module("theOneBlog.controllers").controller("indexCarouselCtrl",["$scope","carouselsService",function(a,b){a.slides=[],a.intervalTime=5e3,b.getIndexList().$promise.then(function(b){a.slides=b})}]),angular.module("theOneBlog.controllers").controller("indexCtrl",["",function(){}]),angular.module("theOneBlog.controllers").controller("mainCtrl",["$scope","headerHelp",function(a,b){b.init(),a.useableLeave=!0,a.pageClass="main"}]),angular.module("theOneBlog.controllers").controller("searchCtrl",["$scope","$timeout","$filter","$stateParams","headerHelp","catesService","searchService",function(a,b,c,d,e,f,g){e.resetAll();var h=d.searchWord,i=[];a.containCates=[],a.pageClass="search",a.search={originList:[],resultList:[],keyWord:h},f.getAllCates().$promise.then(function(a){i=a}),g.getListByKeyWord(h).$promise.then(function(b){a.search.originList=a.search.resultList=b,c("keyWordPoint")(b,h),a.containCates=c("cateContain")(b)}),a.filterCate="",a.setFilter=function(b){var d=[];a.filterCate=b,a.search.originList.length>2&&(d=c("filter")(a.search.originList,b)),a.search.resultList=d}}]);